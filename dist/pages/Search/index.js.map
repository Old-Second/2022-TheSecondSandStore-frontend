{"version":3,"file":"pages/Search/index.js","sources":["webpack:///._src_pages_Search_index.jsx","webpack:///._src_Images_delete.png","webpack:///._src_pages_Search_index.css","webpack:///./src/pages/Search/index.jsx?20f5"],"sourcesContent":["import { Component } from 'react'\r\nimport { View, Input, Text, Image } from '@tarojs/components'\r\nimport Taro from '@tarojs/taro'\r\nimport './index.css'\r\nimport Item from '../../Components/Item'\r\nimport image from '../../Images/搜索.png'\r\nimport back from '../../Images/back.png'\r\nimport Delete from '../../Images/delete.png'\r\nimport Fetch from '../../Service/fetch'\r\n\r\n\r\nexport default class Index extends Component {\r\n  state = {\r\n    historys: [\r\n    ],\r\n    goods: [],\r\n    inputVal: '',\r\n    condition: '',\r\n    hidden: false,\r\n    show: true,\r\n    ifdelete: true //初始状态不显示x号\r\n  }\r\n  componentWillMount() { }\r\n\r\n  componentDidMount() { }\r\n\r\n  componentWillUnmount() { }\r\n\r\n  componentDidShow() {\r\n    let historys = Taro.getStorageSync('history') || [];\r\n    this.setState({\r\n      historys: historys\r\n    });\r\n  }\r\n\r\n  componentDidHide() { }\r\n\r\n  /* //focus \r\n      handleFocus=()=> {\r\n        let historys = Taro.getStorageSync('history') || [];\r\n        this.setState({\r\n        historys: historys\r\n        });\r\n      } */\r\n  //oninput\r\n  onInput(e) {\r\n    const value = e.detail.value\r\n    this.setState({\r\n      inputVal: value,\r\n      condition: value\r\n    })\r\n  }\r\n\r\n  //confirm of Input\r\n  handleConfirm = () => {\r\n    const inputVal = this.state.inputVal\r\n    const { historys, condition } = this.state\r\n    if (inputVal.trim() !== '') {\r\n      // console.log(inputVal)\r\n      if (historys.length < 8) {\r\n        const history = { id: historys.length, name: inputVal }\r\n        const newhistorys = [history, ...historys]\r\n\r\n        this.setState({\r\n          hidden: true,\r\n          historys: newhistorys,\r\n        });\r\n        Taro.setStorageSync('history', newhistorys);\r\n        this.getsearch(condition)\r\n      }\r\n    }\r\n  }\r\n  //清除历史记录\r\n  clearHistory = () => {\r\n    const ifdelete = this.state.ifdelete\r\n    const ifDelete = !ifdelete\r\n    this.setState({\r\n      ifdelete: ifDelete\r\n    })\r\n    /* this.setState({\r\n      historys: []\r\n    });\r\n    Taro.setStorageSync('history', []); */\r\n  }\r\n\r\n  handleDelete = (id) => {\r\n    const { historys } = this.state\r\n    const newHistorys = historys.filter((history) => {\r\n      return history.id !== id\r\n    })\r\n    this.setState({ historys: newHistorys });\r\n    Taro.setStorageSync('history', newHistorys)\r\n  }\r\n\r\n  //返回主页\r\n  handleBack = () => {\r\n    Taro.reLaunch({\r\n      url: '/pages/Square/Square'\r\n    })\r\n  }\r\n\r\n  //搜索结果\r\n  getsearch = (condition) => {\r\n    Fetch(\r\n      `/goods/details/all/condition/${condition}`,\r\n      {},\r\n      'GET'\r\n    ).then(data => {\r\n      // console.log(data);\r\n      this.setState({ goods: [] })\r\n      let newGoods = this.state.goods;\r\n      if (data.data !== null) {\r\n        newGoods = newGoods.concat(data.data);\r\n        Taro.stopPullDownRefresh();\r\n        Taro.hideNavigationBarLoading();\r\n        this.setState({\r\n          goods: newGoods,\r\n          show: false\r\n        });\r\n      } else {\r\n        Taro.showToast({\r\n          title: '没有搜到哦！',\r\n          duration: 2000\r\n        });\r\n        Taro.stopPullDownRefresh();\r\n        Taro.hideNavigationBarLoading();\r\n      }\r\n    })\r\n      .catch(\r\n        () => {\r\n          Taro.showToast({\r\n            icon: 'none',\r\n            title: '出错啦！'\r\n          })\r\n        }\r\n      )\r\n  }\r\n  //click历史记录\r\n  handleClickContent = (name) => {\r\n    this.getsearch(name)\r\n    this.setState({ hidden: true })\r\n  }\r\n\r\n\r\n  render() {\r\n    const { historys, hidden, goods, show, ifdelete } = this.state\r\n    const inputVal = this.state.inputVal\r\n    return (\r\n      <View>\r\n        <View className='search-header'>\r\n          <Image src={back} style={{ width: 20, height: 20, marginLeft: 10 }} onClick={this.handleBack} />\r\n          <Input type='text' placeholder='' value={inputVal} onInput={this.onInput.bind(this)} focus />\r\n          <Image src={image} style={{ width: 32, height: 32 }} onClick={this.handleConfirm} />\r\n        </View>\r\n        {/* 搜索历史 */}\r\n        {hidden ? null : <View className='box'>\r\n          <View className='History'>\r\n            {historys.map((history) => {\r\n              return (\r\n                <View className='search-history' style={{ display: historys.length ? 'block' : 'none' }} key='Search' >\r\n                  <Text key={history.id} onClick={() => this.handleClickContent(history.name)} >{history.name}</Text>\r\n                  {/* x号 */}\r\n                  {ifdelete ? null : <Text onClick={() => this.handleDelete(history.id)} style={{ marginLeft: 7 }} >×</Text>}\r\n                </View>\r\n              )\r\n            })}\r\n          </View>\r\n          <Image src={Delete} style={{ width: 25, height: 25, marginLeft: 15 }} onClick={this.clearHistory} ></Image>\r\n        </View>}\r\n\r\n        {/* 商品 */}\r\n        {show ? null : <View className='show'>\r\n          {goods.map((good) => {\r\n            return (\r\n              <Item content={good.content} price={good.price} iffavorite={good.if_collected} username={good.user_nickname} QQ={good.qq_account} user_image={good.user_image} item_image={good.goods_images_videos} goods_id={good.id} key='item' />\r\n            )\r\n          })}\r\n        </View>\r\n        }\r\n      </View>\r\n    )\r\n  }\r\n}","module.exports = __webpack_public_path__ + \"Images/delete.png\";","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../node_modules/babel-loader/lib/index.js!./index.jsx\"\nvar config = {\"navigationBarTitleText\":\"搜索\"};\n\n\nvar inst = Page(createPageConfig(component, 'pages/Search/index', {root:{cn:[]}}, config || {}))\n\n\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAGA;;;;;;;;;;;;;;;;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;AACA;AAyCA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AACA;AAGA;AACA;AAAA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AADA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;;;AAIA;AACA;AACA;AADA;;;AAMA;AACA;AAKA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAJA;AASA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAvBA;AA2BA;AACA;AACA;AAFA;AA3BA;;;AAmCA;AACA;AACA;AAAA;AAAA;AAAA;;;;;;;;AAtHA;;;AAEA;;;AAEA;;;AAEA;AACA;AACA;AACA;AADA;AAGA;;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAAA;AACA;AACA;AACA;AACA;AAFA;AAMA;AACA;;;AA0FA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAMA;AAAA;AACA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAFA;AADA;AAWA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAZA;AAgBA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AADA;AAvBA;AAiCA;;;;AA1KA;AACA;;;;;;;;;;;;;ACZA;;;;;;;;;;;ACAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}